!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},AngularSyncLocalStorageProviderFactory=_interopRequire(require("./angular-sync-local-storage"));angular.module("angularSyncLocalStorage",["angularUniqueWindow"]).provider("synchronizedLocalStorage",AngularSyncLocalStorageProviderFactory)},{"./angular-sync-local-storage":2}],2:[function(require,module){"use strict";function AngularSyncLocalStorageProviderFactory(){return new AngularSyncLocalStorageProvider}var _createClass=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=!0,prop.value&&(prop.writable=!0)}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")};module.exports=AngularSyncLocalStorageProviderFactory;var AngularSyncLocalStorageProvider=function(){function AngularSyncLocalStorageProvider(){_classCallCheck(this,AngularSyncLocalStorageProvider),this.debounceSyncDelay=300}return _createClass(AngularSyncLocalStorageProvider,{$get:{value:function($rootScope,$window,$timeout,uniqueWindowIdentifier){return new AngularSyncLocalStorage($rootScope,$window,$timeout,uniqueWindowIdentifier,this)}}}),AngularSyncLocalStorageProvider}(),AngularSyncLocalStorage=function(){function AngularSyncLocalStorage($rootScope,$window,$timeout,uniqueWindowIdentifier,providerInstance){_classCallCheck(this,AngularSyncLocalStorage),this.$rootScope=$rootScope,this.$window=$window,this.$timeout=$timeout,this.localStorage=$window.localStorage,this.providerInstance=providerInstance,this.uniqueWindowIdentifier=uniqueWindowIdentifier,this._masterKeyPostfix="__master",this._versionKeyPostfix="__version",this.syncMap={},this.localMap={}}return _createClass(AngularSyncLocalStorage,{_supportsLocalStorage:{value:function(){var testKey="test",storage=this.$window.localStorage;try{return storage.setItem(testKey,"1"),storage.removeItem(testKey),!0}catch(error){return!1}}},_debounce:{value:function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}},_updateLocalStorage:{value:function(key,value){this.localStorage[key]=angular.toJson(value)}},_autoSyncExternalUpdates:{value:function(syncLocal,persistKey){var _this=this;this.$window.addEventListener("storage",function(){syncLocal()&&(_this.$timeout(function(){_this.$rootScope.$broadcast("sls:updated",{key:persistKey})}),_this.$rootScope.$digest())})}},_sync:{value:function(storageService,key,localObject){return function(){var fromStorageContainer;return storageService[key]?(fromStorageContainer=angular.fromJson(storageService[key]),angular.equals(localObject,fromStorageContainer)?!1:(taylorcode.updateModel(localObject,fromStorageContainer),!0)):!1}}},_mirrorLocalStorage:{value:function(persistKey,masterKey,trackMaster){var _this=this;return function(ls,oldLs){ls!==oldLs&&(_this._updateLocalStorage(persistKey,ls),trackMaster&&_this._updateLocalStorage(masterKey,ls))}}},syncLocalObj:{value:function(localObject){for(var key in this.localMap)if(this.localMap[key]===localObject)return this.syncMap[key](localObject)}},synchronize:{value:function(localObject,persistKey,ops){var localObjStringType=Object.prototype.toString.call(localObject);if("[object Object]"!==localObjStringType&&"[object Array]"!==localObjStringType)throw new Error("AngularSyncLocalStorage: object to synchronize with must be an hash or an array.");var synchronizeLocalStorage,trackMaster,masterKey,versionKey,options={uniquePerWindow:!1,restoreFromMaster:!0,initialSync:!0,version:0},syncLocal=null,isNewLsVersion=!1;this._supportsLocalStorage()&&(angular.extend(options,ops),trackMaster=options.uniquePerWindow&&options.restoreFromMaster&&options.initialSync,options.version&&(versionKey=persistKey+this._versionKeyPostfix,options.version!==this.localStorage[versionKey]&&(isNewLsVersion=!0,this.localStorage[versionKey]=options.version)),options.uniquePerWindow&&(this.uniqueWindowIdentifier.ensure(),masterKey=persistKey+this._masterKeyPostfix,persistKey+="_"+this.uniqueWindowIdentifier.get()),isNewLsVersion&&(delete localStorage[persistKey],masterKey&&delete localStorage[masterKey]),syncLocal=this._sync(this.localStorage,persistKey,localObject),options.initialSync&&(trackMaster&&!this.localStorage[persistKey]&&this.localStorage[masterKey]&&(this.localStorage[persistKey]=this.localStorage[masterKey]),syncLocal()),this.syncMap[persistKey]=this._mirrorLocalStorage(persistKey,masterKey,trackMaster),synchronizeLocalStorage=this._debounce(this.syncMap[persistKey],this.providerInstance.debounceSyncDelay,!options.initialSync),this.localMap[persistKey]=localObject,this.$rootScope.$watch(function(){return localObject},synchronizeLocalStorage,!0),options.uniquePerWindow||this._autoSyncExternalUpdates(syncLocal,persistKey))}}}),AngularSyncLocalStorage}()},{}]},{},[1]);
//# sourceMappingURL=angular-sync-local-storage.js.map