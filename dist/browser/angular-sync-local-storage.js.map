{"version":3,"sources":["update-model.js","angular-sync-local-storage.js"],"names":[],"mappings":"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","file":"angular-sync-local-storage.js","sourcesContent":["\"use strict\";\n\nif(!taylorcode) taylorcode = {}\n\ntaylorcode.updateModel = updateModel;\n\nfunction updateModel(oldObj, newObj) {\n\n   if (oldObj.constructor !== newObj.constructor) {\n      throw new Error(\"updateModel: both arguments passed must be of the same type.\");\n   }\n   if (!oldObj instanceof Object) {\n      throw new Error(\"updateModel: arguments passed cannot be primitive.\");\n   }\n\n   function compareElementsAtKey(key) {\n      // property simply doesn't exist in the new object\n      if (!oldObj[key]) {\n         oldObj[key] = newObj[key];\n      } else\n         // they are both either arrays or hashes, and are not of primitive types\n         if (oldObj[key].constructor === newObj[key].constructor && oldObj[key] instanceof Object) {\n            updateModel(oldObj[key], newObj[key]);\n         } else if (oldObj[key] !== newObj[key]) {\n            // all this compares is if primitives are equal, don't reassign\n            oldObj[key] = newObj[key];\n         }\n   }\n\n   if (oldObj instanceof Array) {\n      // we can assume at this point that they are both arrays\n      if (oldObj.length > newObj.length) {\n         oldObj.length = newObj.length // actually mutate the length of the old object -- remove the items that are not in it\n         ;\n      }\n      // the lengths are the same - one to one with new and old object\n      for (var i = 0; i < newObj.length; i++) {\n         compareElementsAtKey(i);\n      }\n   } else {\n      // we can assume that they are both objects\n      // if the old object has any properties that are not in the new object, remove them\n      for (var oldProp in oldObj) {\n         if (!newObj.hasOwnProperty(oldProp)) {\n            delete oldObj[oldProp];\n         }\n      }\n      // now the properties are the same between new and old object\n      for (var prop in newObj) {\n         compareElementsAtKey(prop);\n      }\n   }\n}\n//# sourceMappingURL=update-model.js.map","'use strict';\n\n/**\n  * @ngdoc overview\n  * @name angularSyncLocalStorage\n  * @description\n  * Allows you to automatically synchronize an object with localStorage across browser windows using angular's digest cycle.\n */\n\nclass AngularSyncLocalStorageProvider {\n  constructor() {\n    this.debounceSyncDelay = 300\n  }\n  $get($rootScope, $window, $timeout) {\n    return new AngularSyncLocalStorage($rootScope, $window, $timeout, this) // pass in the provider instance\n  }\n}\n\nfunction AngularSyncLocalStorageProviderFactory () {\n  return new AngularSyncLocalStorageProvider\n}\n\nclass AngularSyncLocalStorage {\n\n  constructor($rootScope, $window, $timeout, providerInstance) {\n    this.$rootScope = $rootScope\n    this.$window = $window\n    this.$timeout = $timeout\n    this.localStorage = $window.localStorage\n    this.supportsLocalStorage = supportsLocalStorage\n    this.debounce = debounce\n    this.sync = sync\n    this.providerInstance = providerInstance\n    this.syncLocal = angular.noop\n  }\n\n  _queryUpdateStorage() {\n    if(this.syncLocal()) {\n      // NOTE timeout is needed because this has the potential to be broadcasted before the ready \n      // event is fired in jquery where this is being listened for\n      // on updated occurs when localStorage is updated outside of the application\n      // and you may have services that need to query the data (such as session information)\n      this.$timeout(() => {\n        this.$rootScope.$broadcast('sls:updated')\n      })\n      this.$rootScope.$digest()\n    }\n  }\n\n  _updateLocalStorage(key, value) {\n    this.localStorage[persistKey] = angular.toJson(value)\n  }\n\n  synchronize(localObject, persistKey, initialSync = true) {\n\n    let localObjStringType = Object.prototype.toString.call(localObject)\n\n    if(localObjStringType === '[object Object]' || localObjStringType === '[object Array]') {\n      throw new Error('AngularSyncLocalStorage: object to synchronize with must be an hash or an array.')\n    }\n\n    if (!this.supportsLocalStorage()) {\n      // silently die if there is no localStorage support\n      return\n    }\n    var synchronizeLocalStorage\n\n    this.syncLocal = this.sync(this.localStorage, persistKey, localObject)\n\n    if (initialSync) {\n      // if we want to initially sync, it will override what's currently in the local object with what is in localStorage\n      this.syncLocal()\n    }\n    // set up to update localStorage only every debounce time\n    // only affects performance of the other windows receiving the update\n    synchronizeLocalStorage = this.debounce((ls) => {\n      this._updateLocalStorage(persistKey, ls)\n    }, this.providerInstance.debounceSyncDelay)\n\n    // deep watch localObject for changes, update localStorage when whey occur\n    this.$rootScope.$watch(() => {\n      return localObject\n    }, synchronizeLocalStorage, true)\n\n    // listen for storage changes, notify\n    this.$window.addEventListener('storage', this._queryUpdateStorage.bind(this))\n\n  }\n\n}\n\nangular.module('angularSyncLocalStorage').provider('synchronizedLocalStorage', AngularSyncLocalStorageProviderFactory)\n\n// helper functions - move to better place\nfunction supportsLocalStorage() {\n  var testKey = 'test',\n      storage = window.localStorage\n  try {\n    storage.setItem(testKey, '1')\n    storage.removeItem(testKey)\n    return true\n  } catch (error) {\n    return false\n  }\n}\n// remove dependency of underscore\nfunction debounce(func, wait, immediate) {\n  var timeout\n  return function() {\n    var context = this, args = arguments\n    var later = function() {\n      timeout = null\n      if (!immediate) func.apply(context, args)\n    }\n    var callNow = immediate && !timeout\n    clearTimeout(timeout)\n    timeout = setTimeout(later, wait)\n    if (callNow) func.apply(context, args)\n  }\n}\n\nfunction sync(storageService, key, localObject) {\n  return function () {\n    var storageContainer\n    // if there's no container (such as localStorage, then create it)\n    if(!storageService[key]) {\n      storageContainer = storageService[key] = {}\n    } else {\n      storageContainer = angular.fromJson(storageService[key])\n    }\n    // if the storage containers stuff isn't the same as the local object\n    if (!angular.equals(localObject, storageContainer)) {\n      // update the local object with the storage containers stuff\n      taylorcode.updateModel(localObject, storageContainer)\n      return true\n    }\n    return false\n  }\n}\n\n\n\n// ---\n// generated by coffee-script 1.9.0"],"sourceRoot":"/source/"}